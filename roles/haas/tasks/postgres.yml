---
- name: install postgres
  yum: name={{ item }} state=present
  with_items:
   - python-psycopg2
   - postgresql-server
   - postgresql-contrib
   - postgresql
  register: postgres

- name: init db
  command: postgresql-setup initdb
  when: postgres.changed

- name: copy pg_hba.conf
  copy:
    src=pg_hba.conf
    dest=/var/lib/pgsql/data/pg_hba.conf

- name: restart postgresql
  service:
    name=postgresql
    state=restarted
    enabled=yes

- name: create db for haas
  become: yes
  become_user: postgres
  postgresql_db: name={{ haas_user }}

- name: create db user for haas
  become: yes
  become_user: postgres
  postgresql_user:
    db={{ haas_user }}
    name={{ haas_user }}
    password={{ haas_pass }}
    priv=CONNECT/ALL
